{% if trigger == "dc-job-status" and job_status <= 2 %}
    <div id="dc-job-status"
       hx-get="/jobs/{{ jid }}"
       hx-trigger="load delay:1s"
       hx-swap="outerHTML">
        <p>Your job is currently being processed, please wait a bit longer.</p>
    </div>
{% else %}
    <div id="dc-job-details" class="dc-content" {% if trigger == "dc-job-status" %}hx-swap-oob="true"{% endif %}>
        <h2 {% if job_status <= 2 %}class="text-center"{% endif %}>Job Status - {{ jid }}</h2>
        {% if job_status <= 2 %}
            <div class="text-center">
                <div id="dc-job-status"
                   hx-get="/jobs/{{ jid }}"
                   hx-trigger="load delay:1s"
                   hx-swap="outerHTML">
                    <p>Your job is currently being processed, please wait a bit {% if htmx %}longer{% else %}and click <a href="">here</a> to refresh{% endif %}.</p>
                </div>
                <div id="dc-job-detail-spinner" class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        {% elif job_status == 4 %}
            <p>There was an error while processing your job.</p>
            <pre>{% for log in job_log %}{{ log|e }}{% endfor %}</pre>
            <a href="/" hx-boost="true">Upload another document</a>
        {% else %}
            <a class="float-end" href="/" hx-boost="true">Upload another document</a>
            <p>
                Your job was processed successfully.<br />
                {% if job_sid is none %}This document will remain available for download for roughly 10 minutes and then be purged from this server.{% endif %}
                If you want to have it deleted right now, <a href="/jobs/{{ jid }}/delete" hx-boost="true" hx-target="#dc-job-details">click here</a>.
            </p>
            <div class="d-grid">
                <a class="btn btn-primary mb-3" href="/jobs/{{ jid }}/result" download>Download result</a>
            </div>
            <div class="row">
                <div class="col-12">
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col" class="col-2"></th>
                                <th scope="col" class="col-5">Original Metadata</th>
                                <th scope="col" class="col-5">Remaining Metadata</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for group, group_members in meta_src["primary"].values() | groupby("group") if group %}
                                <tr class="table-light">
                                    <td colspan="3" class="text-center">
                                        {{ group }}
                                    </td>
                                </tr>
                                {% for member in group_members %}
                                    <tr>
                                        <td><strong>{{ member["name"]|e }}</strong></td>
                                        <td>{{ member["value"]|e }}</td>
                                        <td {% if member["id"] in meta_result["primary"] and member["value"] != meta_result["primary"][member["id"]]["value"] %}class="text-success"{% endif %}>
                                            {% if member["id"] in meta_result["primary"] %}
                                                {{ meta_result["primary"][member["id"]]["value"]|e }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                                {% for result_member in meta_result["primary"].values() | selectattr("group", "eq", group) %}
                                    {% if result_member["id"] not in meta_src["primary"] %}
                                        <tr>
                                            <td><strong>{{ result_member["name"]|e }}</strong></td>
                                            <td></td>
                                            <td class="text-success">{{ result_member["value"]|e }}</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% if meta_src["embeds"]|length > 0 %}
                <h3>Embedded Documents</h3>
                <p>Your document contains embedded documents that might have potentially privacy-invasive metadata attached to them.
                In an attempt to preserve the original document as much as possible, docleaner did <strong>NOT</strong> modify metadata
                of these embedded documents. Therefore, the original and remaining metadata in the following columns should be identical.</p>
                <p>Please review the metadata of the following embedded documents for potentially privacy-invasive information. Click on a document
                to view its metadata. If you encounter data that should be removed, manually edit the original embedded source documents and
                recreate your final document (e.g. by removing EXIF tags from an embedded picture and then reimporting it into a PDF).</p>
                <div class="row">
                    <div class="col-6">
                        <h4>Original Metadata</h4>
                        <dl class="row">
                            <div class="accordion" id="dc-meta-orig">
                                {% for doc_id, doc_data in meta_src["embeds"].items() %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="dc-meta-orig-{{ doc_id }}-heading">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dc-meta-orig-{{ doc_id }}-content" aria-expanded="false" aria-controls="dc-meta-orig-{{ doc_id }}-content">
                                                #{{ doc_id }}
                                                {% if "_type" in doc_data %}
                                                    ({{ doc_data["_type"]["value"] }})
                                                {% endif %}
                                                {% for group in doc_data.values() | map(attribute="group") | unique if group %}
                                                    {{ ":" if loop.first }}
                                                    {{ group }}{{ "," if not loop.last }}
                                                {% endfor %}
                                            </button>
                                        </h2>
                                        <div id="dc-meta-orig-{{ doc_id }}-content" class="accordion-collapse collapse" aria-labelledby="dc-meta-orig-{{ doc_id }}-heading" data-bs-parent="#dc-meta-orig">
                                            <div class="accordion-body">
                                                <dl class="row">
                                                    {% for group, group_data in doc_data.values() | rejectattr("group", "none") | groupby("group") %}
                                                        <dt class="col-5 overflow-auto">{{ group|e }}</dt>
                                                        <dd class="col-7 overflow-auto">
                                                            {% for tag in group_data %}
                                                                <strong>{{ tag["name"]|e }}</strong><br />{{ tag["value"]|e }}<br />
                                                            {% endfor %}
                                                        </dd>
                                                    {% endfor %}
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </dl>
                    </div>
                    <div class="col-6">
                        <h4>Remaining Metadata</h4>
                        <dl class="row">
                            <div class="accordion" id="dc-meta-result">
                                {% for doc_id, doc_data in meta_result["embeds"].items() %}
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="dc-meta-result-{{ doc_id }}-heading">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dc-meta-result-{{ doc_id }}-content" aria-expanded="false" aria-controls="dc-meta-result-{{ doc_id }}-content">
                                                #{{ doc_id }}
                                                {% if "_type" in doc_data %}
                                                    ({{ doc_data["_type"]["value"] }})
                                                {% endif %}
                                                {% for group in doc_data.values() | map(attribute="group") | unique if group %}
                                                    {{ ":" if loop.first }}
                                                    {{ group }}{{ "," if not loop.last }}
                                                {% endfor %}
                                            </button>
                                        </h2>
                                        <div id="dc-meta-result-{{ doc_id }}-content" class="accordion-collapse collapse" aria-labelledby="dc-meta-result-{{ doc_id }}-heading" data-bs-parent="#dc-meta-result">
                                            <div class="accordion-body">
                                                <dl class="row">
                                                    {% for group, group_data in doc_data.values() | rejectattr("group", "none") | groupby("group") %}
                                                    <dt class="col-5 overflow-auto">{{ group|e }}</dt>
                                                    <dd class="col-7 overflow-auto">
                                                        {% for tag in group_data %}
                                                        <strong>{{ tag["name"]|e }}</strong><br />{{ tag["value"]|e }}<br />
                                                        {% endfor %}
                                                    </dd>
                                                    {% endfor %}
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </dl>
                    </div>
                </div>
            {% endif %}
    {% endif %}
    </div>
{% endif %}
