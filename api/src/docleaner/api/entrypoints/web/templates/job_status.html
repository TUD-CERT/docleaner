<div class="dc-content"
     {% if job_status <= 2 %}
         hx-get="/jobs/{{ jid }}"
         hx-trigger="load delay:1s"
         hx-swap="outerHTML"
    {% endif %}>
    <h2>Job Status - {{ jid }}</h2>
    {% if job_status <= 2 %}
        <div class="text-center">
            <p>Your job is currently being processed, please wait a bit {% if htmx %}longer{% else %}and click <a href="">here</a> to refresh{% endif %}.</p>
            <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
            </div>
        </div>
    {% elif job_status == 4 %}
        <p>There was an error while processing your job.</p>
        <pre>{% for log in job_log %}{{ log|e }}{% endfor %}</pre>
    {% else %}
        <p>Your job was processed successfully.</p>
        <div class="d-grid">
            <a class="btn btn-primary mb-3" href="/jobs/{{ jid }}/result" download>Download result</a>
        </div>
        <div class="row">
            <div class="col-6">
                <h3>Original Metadata</h3>
                <dl class="row">
                    {% for key, val in meta_src["doc"].items() %}
                        <dt class="col-3">{{ key|e }}</dt>
                        <dd class="col-9">{{ val|e }}</dd>
                    {% endfor %}
                    <div class="accordion" id="dc-meta-orig">
                        {% for doc_id, doc_data in meta_src["embeds"].items() %}
                            <div class="accordion-item">
                                <h2 class="accordion-header" id="dc-meta-orig-{{ doc_id }}-heading">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dc-meta-orig-{{ doc_id }}-content" aria-expanded="false" aria-controls="dc-meta-orig-{{ doc_id }}-content">
                                        {{ doc_id }}
                                        {% if "File" in doc_data and "FileType" in doc_data["File"] %}
                                            ({{ doc_data["File"]["FileType"]}})
                                        {% endif %}
                                    </button>
                                </h2>
                                <div id="dc-meta-orig-{{ doc_id }}-content" class="accordion-collapse collapse" aria-labelledby="dc-meta-orig-{{ doc_id }}-heading" data-bs-parent="#dc-meta-orig">
                                    <div class="accordion-body">
                                        <dl class="row">
                                            {% for data_key, data_val in doc_data.items() %}
                                                {% if data_key != "File" %}
                                                    <dt class="col-5">{{ data_key|e }}</dt>
                                                    <dd class="col-7">
                                                        {% if data_val is mapping %}
                                                            {% for tag_name, tag_val in data_val.items() %}
                                                                <strong>{{ tag_name }}</strong><br />
                                                                {% if tag_val is string and "option to extract" in tag_val %}
                                                                    Binary Data
                                                                {% else %}
                                                                    {{ tag_val }}
                                                                {% endif %}
                                                                <br />
                                                            {% endfor %}
                                                        {% else %}
                                                            {{ data_val|e }}
                                                        {% endif %}
                                                    </dd>
                                                {% endif %}
                                            {% endfor %}
                                        </dl>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </dl>
            </div>
            <div class="col-6">
                <h3>Remaining Metadata</h3>
                <dl class="row">
                    {% for key, val in meta_src["doc"].items() %}
                        <dt class="col-3">{{ key|e }}</dt>
                        {% if key in meta_result["doc"] %}
                            <dd class="col-9 {% if val != meta_result["doc"][key] %}text-success{% endif %}">{{ meta_result["doc"][key]|e }}</dd>
                        {% else %}
                            <dd class="col-9 text-danger">{{ meta_result["doc"][key]|e }}&nbsp;</dd>
                        {% endif %}
                    {% endfor %}
                    {% for key, val in meta_result["doc"].items() %}
                        {% if key not in meta_src["doc"] %}
                            <dt class="col-3">{{ key|e }}</dt>
                            <dd class="col-9 text-success">{{ val|e }}</dd>
                        {% endif %}
                    {% endfor %}
                    <div class="accordion" id="dc-meta-result">
                        {% for doc_id, doc_data in meta_result["embeds"].items() %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="dc-meta-result-{{ doc_id }}-heading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dc-meta-result-{{ doc_id }}-content" aria-expanded="false" aria-controls="dc-meta-result-{{ doc_id }}-content">
                                    {{ doc_id }}
                                    {% if "File" in doc_data and "FileType" in doc_data["File"] %}
                                        ({{ doc_data["File"]["FileType"]}})
                                    {% endif %}
                                </button>
                            </h2>
                            <div id="dc-meta-result-{{ doc_id }}-content" class="accordion-collapse collapse" aria-labelledby="dc-meta-result-{{ doc_id }}-heading" data-bs-parent="#dc-meta-result">
                                <div class="accordion-body">
                                    <dl class="row">
                                        {% for data_key, data_val in doc_data.items() %}
                                            {% if data_key != "File" %}
                                                <dt class="col-5">{{ data_key|e }}</dt>
                                                <dd class="col-7">
                                                    {% if data_val is mapping %}
                                                        {% for tag_name, tag_val in data_val.items() %}
                                                            <strong>{{ tag_name }}</strong><br />
                                                            {% if tag_val is string and "option to extract" in tag_val %}
                                                                Binary Data
                                                            {% else %}
                                                                {{ tag_val }}
                                                            {% endif %}
                                                            <br />
                                                        {% endfor %}
                                                    {% else %}
                                                        {{ data_val|e }}
                                                    {% endif %}
                                                </dd>
                                            {% endif %}
                                        {% endfor %}
                                    </dl>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </dl>
            </div>
        </div>
<a href="/" hx-boost="true">Upload another document</a>
{% endif %}
</div>
